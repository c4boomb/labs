\input{../common/head.tex}
\input{config.tex}
\usepackage{csvsimple}

\begin{document}

\import{1_title/}{title.tex}

\clearpage

\pagenumbering{gobble}
%\import{3_abstract/}{main.tex}

%\pagestyle{empty}
%\thispagestyle{empty}
%\tableofcontents

\clearpage
\pagenumbering{arabic}
\pagestyle{fancy}
\setcounter{page}{2}

\clearpage

\chapter{Данные}

Материалы для лабораторной работы были получены на геопортале геологической служды США --- USGS \cite{USGS}. Скачанный архив содержит каналы изображений. Каждое изображение космических аппаратов (КА) серии Landsat имеет уникальный идентификатор, структура которого следующая:

[Идентификатор сенсора и КА (3 символа)] + [Координаты снимка в WRS-2-системе (Path, Row, 6 символов)] + [Год] + [DOY] + [Режим съёмки (5 символов)].

Например, LC81810252015048LGN00 --- снимок КА Landsat-8, полученный сенсором OLI/TIRS; координаты снимка в системе WRS-2 --- 818 (Path) 102 (Row), съёмка проведена 48-го дня 2015 года, режим съёмки LGN00. Содержание архива с продуктом уровня обработки  данного снимка изображено на рисунке \ref{archive}. 

\begin{figure}[h]
  \centering
  \includegraphics[width=.75\textwidth]{archive.png}
  \caption{Архив с продуктом обработки дынных КА Landsat-8 OLI/TIRS уробня обратотки L1T}
\label{archive}
\end{figure}


\chapter{Задание}

Средствами командной строки операционной чистемы, а также с помощью бинариев библиотеки GDAL разработать автоматический сценарий, который будет совершать обработку данных дистанционного зондирования Земли (ДЗЗ), соответственнос поставленными заданиями.

Задание 1. Распаковка набора архивов с продуктами ДЗЗ в новосозданные папки, названия которых будут соответствовать идентификаторам изображения.

Задание 2. Конкатинация каналов видимого, ближнего и среднего инфракрасного спектрального диапазонов изображения в единственный GEOTIFF файл.

Задание 3. Перепроектирование спутникового изображения в указанную картографическую систему координат.

Задание 4. Конкатинация изображений двух соседних <<row>> с одинаковым <<path>>.

Задание 5. Обрезка результирующего изображения по заданному векторному контуру.

Ход выполнения работы. Получить архивы с сутниковыми изображениями, и файл с векторным контуром для дальнейшей обрезки. Средствами командной строки операционной системы (без ограничения в выборе ОС) и с использованием бинариев библиотеуи GDAL создать программный сценарий для автоматической обработки спутниковых изображений согласно поставленным заданиям. 

\chapter{Выполнение задания}

\section{Распаковка каналов изображения}

Был использован архиватор tar. Приведённый ниже сценарий (sh-файл) распаковывает все архивы, которые содержатся в текущей папке.

\lstset{inputencoding=utf8, extendedchars=\true}
\lstinputlisting[language=bash,
                 basicstyle=\ttfamily\scriptsize]{source/maps/untar.sh}

В качестве переменной \$file выступают имена всех файлов формата .tar.gz.

\section{Конкатинация каналов изображения}

В архиве .tar.gz содержатся каналы спутникового изображения в отдельных GEOTIFF-файлах. Для того, чтобы сконкатинировать их, была вызвана следующая команда:

\lstset{language=bash}
\begin{lstlisting}
gdal_merge.py -o concatenated.tif -separate *.TIF,
\end{lstlisting}

где concatenated.tif --- результат конкатинации, *.TIFF --- каналы изображений, взятые из соответствующего архива.

\section{Перепроектирование изображения}

Для изменения герграфической проекции использовалась команда gdalwrap:

\lstset{language=bash}
\begin{lstlisting}
gdalwarp -t_srs "epsg:4326" concatenated.tif out.tif,
\end{lstlisting}

где <<epsg:4326>> --- параметры проекции, в которую совершалось перепроектирование.

\section{Конкатинация изображений с разными Row}

Для конкатинации изображений, которые не совпадают территориально (одинаковые Path и соседние Row), была использована команда gdalwarp:

\lstset{language=bash}
\begin{lstlisting}
gdalwarp -of GTIFF -ot Uint16 \
	LC81800262016108LGN00/concatenated.tif \
	LC81800272016108LGN00/concatenated.tif \
	concatenated.tif.
\end{lstlisting}

Значение параметра -of отвечает формату исходящего файла, а значение параметра -ot --- его типу.

С помощью gdalwarp можно объединить изображения, которые территориально не перекрываются и имеют разные размеры, однако количество каналов в них обязательно должно быть одинаковым.

\section{Обрезка растрового изображения по векторному контуру}

Команда, которая была использована для совершения обрезки растра по векторному контуру приведена ниже:

\lstset{language=bash}
\begin{lstlisting}
gdalwarp -q -cutline polygon.shp -crop_to_cutline -of \
	GTiff concatenated.tif cropped_shape.tif
\end{lstlisting}

где в файде polygon.shp содержится необходимый векторный контур. Данный контур был нарисован в ГИС-системе QGIS (Quantum GIS) поверх снимка (был создан новый векторный слой с полигоном). 

concatenated.tif и cropped\_shape.tif соответственно входящее и обрезанное растровые изображения.

Данное задание также было выполнено с помощью QGIS. Для этого были выбраны растровые данные (concatenated.tif), во вкладке Raster/Ectraction/Clipper путь для исходящего файла (cropped.tif). Во вкладке Mask layer выбран векторный контур, по которому необходимо провести обрезку (polygon.shp). После нажатия на кнопку OK было создано необходимое обрезанное изображение.

\chapter*{Выводы}
\addcontentsline{toc}{chapter}{Выводы}

GDAL --- это библиотека для работы с растровыми географическими форматами файлов данных. Утилиты GDAL предназначены для конвертации растровых данных из одного формата в другой и выполнения над ними различных операций, например, конкатинация каналов снимка, перепроектирование, обрезка по векторному контуру.

QGIS (Quantum GIS) --- свободная кроссплатформенная геоинформационная система, которая использует библиотеки GDAL. QGIS имеет много возможностей, были использованы следующие:
\begin{itemize}
\item просмотр и накладка друг на друга векторных и растровых данных;
\item создание и редактирование shape-файлов и векторных слоёв;
\item обрезка растровых данных по векторному контуру.
\end{itemize}

\clearpage
\phantomsection
\addcontentsline{toc}{chapter}{Список литературы}
\renewcommand\bibname{Список литературы}
\bibliography{bibliography.bib}

\end{document}
